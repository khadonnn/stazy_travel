// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  extensions = [vector]
}
model User {
  id          String    @id @default(uuid()) 
  
  // Thông tin đăng nhập & Cơ bản
  email       String    @unique
  password    String?    
  name        String    
  nickname    String?
  phone       String?
  gender      String?
  dob         DateTime? 
  address     String?
  
  avatar      String?   
  bgImage  String?   
  
  jobName     String?  
  desc         String?   @db.Text
  
  role        Role      @default(USER) // Enum: USER, AUTHOR, ADMIN
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Quan hệ: Một User có thể đăng nhiều Hotel
  hotels      Hotel[]
  interactions Interaction[]
recommendation Recommendation?
  @@map("users")
}

// --- ENUM ROLE ---
enum Role {
  USER
  AUTHOR
  ADMIN
}
model Hotel {
  id                 Int      @id @default(autoincrement())
  
  // -- Relations --
  authorId           String
  author            User     @relation(fields: [authorId], references: [id])
  
  categoryId  Int
  category           Category @relation(fields: [categoryId], references: [id])

  // -- Info --
  date               DateTime @default(now()) // Đổi sang DateTime để dễ query time range
  slug           String   @unique
  title              String
  featuredImage      String
  
  // -- Arrays (Postgres Only) --
  galleryImgs        String[] 
  amenities          String[]

  description        String   @db.Text
  price              Decimal  @db.Decimal(12, 2)
  address            String
  
  // -- Ratings & Stats --
  reviewStar        Float    @default(0)
  reviewCount        Int      @default(0)
  viewCount          Int      @default(0)
  commentCount       Int      @default(0)
  
  like               Boolean  @default(false)
  isAds              Boolean  @default(false)
  
  // -- Room Info --
  maxGuests          Int
  bedrooms           Int
  bathrooms          Int
  
  // -- Sale Off Logic --
  saleOff            String?  // Text hiển thị: "-5% hôm nay"
  saleOffPercent     Int      @default(0) // Số để Query/Sort: 5 (Đây là cột quan trọng mới thêm)

  // -- Map -- 
  map                Json     
  // -- AI Vector -- 
  fullDescription String? @db.Text
  policies      String? @db.Text
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  imageVector    Unsupported("vector(512)")?

interactions Interaction[]
  @@map("hotels")
}


model Category {
  id        Int      @id @default(autoincrement())
  name      String
  slug      String   @unique
  description String?  @db.Text
  // TwMainColor thường là một chuỗi class name (vd: "red", "blue") hoặc mã màu
  color     String?  
  
  // Chứa tên icon (vd: "HiOutlineHome") hoặc đường dẫn SVG
  icon      String?  
  
  // Field này thường là tính toán (computed), nhưng nếu bạn muốn lưu cứng:
  count     Int      @default(0)
  
  // Đường dẫn ảnh thumbnail
  thumbnail String?

  // Quan hệ ngược lại với Hotel (đã có trong schema trước của bạn)
  hotels    Hotel[]

  @@map("categories")
}

// 1. Bảng lưu hành vi người dùng (Input cho AI)
model Interaction {
  id        Int      @id @default(autoincrement())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  hotelId   Int
  hotel     Hotel    @relation(fields: [hotelId], references: [id])
  
  // Hành động: VIEW (1 điểm), LIKE (3 điểm), BOOK (5 điểm)
  action    String   
  weight    Float    // Điểm số quy đổi từ hành động
  
  createdAt DateTime @default(now())

  @@map("interactions")
}

// 2. Bảng lưu kết quả gợi ý (Output của AI)
// Để Frontend chỉ việc query bảng này là ra list gợi ý
model Recommendation {
  id        Int      @id @default(autoincrement())
  userId    String 
  
  
  // List các hotel ID được gợi ý (lưu dạng mảng số nguyên)
  hotelIds  Int[]    
  
  user     User     @relation(fields: [userId], references: [id])
  updatedAt DateTime @updatedAt
  @@unique([userId]) // Mỗi user chỉ có 1 dòng gợi ý mới nhất
  @@map("recommendations")
}